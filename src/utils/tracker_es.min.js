const tracker=function(e){let t="https://collecter.frontjs.com/",r="tracker_es.min.js",n="1.0.0-rc.4",o=5e3,a=1,i=256,l=1024,s={};const c=function(e,t){t=t||"";let r={1001:"Invalid token",1002:"Invalid behaviour settings",1003:"Invalid origin settings",1004:"Invalid exclude settings",1005:"Invalid user data",4000:"Bad configuration! Fail to start!",4001:"FrontJS is already defined, Fail to start!"};r[e]&&console.warn(["Error(frontjs):",r[e],"(CODE"+e+")","See https://www.frontjs.com/doc/view/errcode/#"+encodeURIComponent(t)].join(" "))},u=function(e){return e&&e.match(/^\w{32}$/)?0:1},f=function(e){return e<=(14|a)?0:1},g=function(e){e=e||[];for(var t=0;t<e.length;t++)if("string"==typeof e[t]);else if(!e[t].test)return e[t];return 0},p=function(e){for(var t in e=e||{})if("object"==typeof e[t])return t;return 0},d=wx.getSystemInfoSync(),m={unknown:0,none:1,wifi:3,"2g":4,"3g":5,"4g":6};let h=null,y=null,v=null,w=0,S=null,D=[/\[(\d|\s|:|-)*\]\s*request\s+(begin|success|fail)/g];const b={KVArrayCopy:function(e){var t={};for(var r in e)t[r]=e[r];return t},uriArrayCopy:function(e){e=e||[];for(var t=[],r=0;r<e.length;r++)"string"==typeof e[r]?t.push(e[r]):t.push(new RegExp(e[r].source,e[r].flag));return t},getTime:function(){return(new Date).getTime()},getGUID:function(){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],t=b.getTime().toString(16);for(t="0"+t;t.length<16;)t="f"+t;for(;t.length<32;)t+=e[Math.floor(16*Math.random())];return t},stringifyParameter:function(e){var t=[];if(e&&e.length){for(var r=0;r<e.length;r++)if(null===e[r])t.push("null");else if(void 0===e[r])t.push("undefined");else if(e[r]instanceof Array&&"string"==typeof e[r].toString())t.push("["+e[r].toString()+"]");else if("object"==typeof e[r]){var n=[];for(var o in e[r]){var a="";if(a+=o+": ",null===e[r][o])a+="null";else if(void 0===e[r][o])a+="undefined";else{switch(typeof e[r][o]){case"object":e[r][o]instanceof Array&&"string"==typeof e[r][o].toString()?a+="["+e[r][o].toString()+"]":"function"==typeof e[r][o].valueOf&&"string"==typeof e[r][o].valueOf()?a+=e[r][o].valueOf():"function"==typeof e[r][o].toString&&"string"==typeof e[r][o].toString()?a+=e[r][o].toString():a+="[object]";break;case"function":a+="[function]";break;default:a+=e[r][o].toString()}}n.push(a)}t.push("{"+n.join(", ")+"}")}else"function"==typeof e[r].valueOf&&"string"==typeof e[r].valueOf()?t.push(e[r].valueOf()):"function"==typeof e[r].toString&&"string"==typeof e[r].toString()?t.push(e[r].toString()):t.push("[object]");return t.join(", ")}return"[object]"},addSlashes:function(e){return e.replace(/(\.|\\|\/|\||\+|\$|\^)/g,"\\$1")},filterTrace:function(e){var t=new RegExp("((?!\\n).)*"+b.addSlashes(r)+".*\\n","g");return e.replace(t,"")},getUserAgent:function(){return"N/A"},getCurrentURL:function(){return y},getRefererURL:function(){return h},getViewPortSize:function(){return{w:d.windowWidth,h:d.windowHeight,r:d.pixelRatio}},getClientID:function(){return wx.getStorageSync("frontjs:client:id")||wx.setStorageSync("frontjs:client:id",b.getGUID()),wx.getStorageSync("frontjs:client:id")},getSessionID:function(){return v||(v=b.getGUID()),v},checkCrossOrigin:function(e,t){if(t){e=e||"";for(var r=!1,n=0;n<t.length;n++)""!==t[n]&&e.match(t[n])&&(r|=!0);return!r}return!1},checkIgnorePattern:function(e){if(e)for(var t=0;t<D.length;t++)if(e.match(D[t]))return!0;return!1},checkTimingSlow:function(e,t){return!!t&&(e.send>t.sned&&t.sned>0||e.load>t.load&&t.load>0||e.total>t.total&&t.total>0)},calculateTrackerTiming:function(e){if(e._time_done&&e._time_load&&e._time_send&&e._time_done){var t=e._time_send-e._time_open,r=e._time_load-e._time_send,n=e._time_done-e._time_open;return{send:t=t<0?null:t,load:r=r<0?null:r,total:n=n<0?null:n}}return{send:0,load:0,total:0}},composeTrackerData:function(e,t){return{type:e,data:t}},composeScriptErrorData:function(e,t,r,n,o,a){return a=a&&a.stack?a.stack.toString():"",{message:e,detail:{err:t,file:r,line:n,column:o,trace:a=b.filterTrace(a)}}},composeXHRErrorData:function(e,t,r,n){return{message:e,detail:{requestURL:t,responseData:r,timing:n}}},composeResourceErrorData:function(e,t,r,n=null){return n?{message:e,detail:{tagname:t,resourceURL:r,response:n.response}}:{message:e,detail:{tagname:t,resourceURL:r}}},composePerformaceData:function(e,t){return{message:e,detail:t}}};let k=function(e){var n={},o=!0;if(u(e.token)?(c(1001),o&=!1):n.token=e.token.toString(),f(e.behaviour)?(c(1002),o&=!1):(n.behaviour=parseInt(e.behaviour),n.behaviour||(n.behaviour=14|a)),g(e.origin)){var i=g(e.behaviour);c(1003,i),o&=!1}else n.origin=b.uriArrayCopy(e.origin),n.origin.push(/^((?!:\/\/).)*$/),n.origin.push(r),n.origin.push(t);return g(e.exclude)?(i=g(e.exclude),c(1004,i),o&=!1):(n.exclude=b.uriArrayCopy(e.exclude),n.exclude.push(r),n.exclude.push(t)),p(e.userData)?(i=p(e.userData),c(1005,i),o&=!1):n.userData=b.KVArrayCopy(e.userData),!!o&&n}(e);if(!k)return c(4e3),!1;(s={}).brand=d.brand,s.model=d.model,s.osType=d.platform,s.osversion=d.system,s.deviceID=b.getClientID(),s.freeDiskSpace=null,s.freeRam=null,s.isRoot=null,s.isPortrait=null,s.name=null,s.network=null,wx.getNetworkType({success:function(e){s.network=m[e.networkType]}}),wx.onNetworkStatusChange(function(e){s.network=m[e.networkType]});let T={request:function(e){let t=e[0].success,r=e[0].fail,n=b.getTime(),o=0;e[0].success=function(){o=b.getTime();let r=b.composeXHRErrorData(771,e[0].url,{status:arguments[0].statusCode},{send:0,load:o-n,total:o-n});b.checkCrossOrigin(e[0].url,k.exclude)&&4&k.behaviour&&_(768,r),t&&t.apply(this,[].slice.call(arguments))},e[0].fail=function(){o=b.getTime();let t=b.composeXHRErrorData(769,e[0].url,{status:0},{send:o-n,load:0,total:o-n});b.checkCrossOrigin(e[0].url,k.exclude)&&4&k.behaviour&&_(768,t),r&&r.apply(this,[].slice.call(arguments))}},downloadFile:function(e){let t=e[0].success,r=e[0].fail,n=b.getTime(),o=0;e[0].success=function(){o=b.getTime();let r=b.composeResourceErrorData(515,"wx.downloadFile",e[0].url,{response:o-n});b.checkCrossOrigin(e[0].url,k.exclude)&&2&k.behaviour&&e[0].url&&_(512,r),t&&t.apply(this,[].slice.call(arguments))},e[0].fail=function(){let t=b.composeResourceErrorData(513,"wx.downloadFile",e[0].url);b.checkCrossOrigin(e[0].url,k.exclude)&&2&k.behaviour&&e[0].url&&_(512,t),r&&r.apply(this,[].slice.call(arguments))}}},R=wx;if(wx.tracker)return c(4001),null;{let e={};for(var C in wx)if(T[C]){let t=C.toString();e[t]=function(){return T[t](arguments),R[t].apply(R,[].slice.call(arguments))}}else e[C]=R[C];e.tracker=!0,wx=e}let x=Page;Page=function(){let e=arguments,t=e[0].onShow,r=e[0].onHide;e[0].onShow=function(){let e=getCurrentPages();h=y,y=e.length>0?e[e.length-1].route:"",w=b.getTime(),t&&t.apply(this,[].slice.call(arguments)),S=b.getGUID();let r=b.composePerformaceData(l,{view:0});_(l,r)},e[0].onHide=function(){let e=b.getTime()-w,t=b.composePerformaceData(l,{view:e});_(l,t),r&&r.apply(this,[].slice.call(arguments))},x.apply(null,[].slice.call(arguments))};let I=App;if(App=function(){let e=arguments,t=e[0].onError,r=e[0].onShow,n=e[0].onHide;e[0].onError=function(){F.catch(arguments[0]),t&&t.apply(this,[].slice.call(arguments))},e[0].onShow=function(){
  // R.getClipboardData({success(e){R.setStorageSync("frontjs:cb:content",e.data)}}),
  r&&r.apply(this,[].slice.call(arguments))},e[0].onHide=function(){let e=R.getStorageSync("frontjs:cb:content");
  // R.getClipboardData({success(t){t.data&&e!=t.data||H()},fail(e){H()}}),
  n&&n.apply(this,[].slice.call(arguments))},e[0].FrontJS=q,I.apply(null,[].slice.call(arguments))},console){var E=console.log,U=console.warn,P=console.error;console.log=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var t=b.composeScriptErrorData(257,b.stringifyParameter(e).substr(0,1e3),"via console.log",0,0,new Error(b.stringifyParameter(e).substr(0,1e3)));k.behaviour&a&&_(i,t),E.apply(console,e)},console.warn=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var t=b.composeScriptErrorData(258,b.stringifyParameter(e).substr(0,1e3),"via console.warn",0,0,new Error(b.stringifyParameter(e).substr(0,1e3)));k.behaviour&a&&_(i,t),U.apply(console,e)},console.error=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var t=b.composeScriptErrorData(259,b.stringifyParameter(e).substr(0,1e3),"via console.error",0,0,new Error(b.stringifyParameter(e).substr(0,1e3)));k.behaviour&a&&_(i,t),P.apply(console,e)}}function _(e,t){var r=!1,o=b.composeTrackerData(e,t);o.currentURL=b.getCurrentURL(),o.refererURL=b.getRefererURL(),o.currentRoute=o.currentURL,o.refererRoute=o.refererURL,o.viewPort=b.getViewPortSize(),o.userAgent=b.getUserAgent(),o.clientID=b.getClientID(),o.sessionID=b.getSessionID(),e===l?(o.messageID=S,r=!0):o.messageID=b.getGUID(),o.token=k.token,o.version=n,o.userData=k.userData,o.deviceData=s,setTimeout(function(){A(o,r)},0)}var O=[],j=null;function A(e,r){e&&O.push(e),r&&O.length&&(wx.request({url:t,data:O,method:"POST"}),O=[],clearTimeout(j),L())}function L(){j=setTimeout(function(){A(null,!0),L()},o)}L();let F=function(e){function t(e){return e.message||(e=new Error(e)),e.error=e,e.filename=e.filename?e.filename:"",e.filename+=" via frontJS try - catch API",e.lineno=e.lineno?e.lineno:0,e.colno=e.colno?e.colno:0,function(e){if(!e.message)return!0;var t=b.composeScriptErrorData(i,e.message,e.filename,e.lineno,e.colno,e.error);b.checkCrossOrigin(e.filename,k.exclude)&&k.behaviour&a&&_(i,t)}(e),null}return{try:function(){var e=arguments[0],r=arguments[1];try{return e.apply(r,[].slice.call(arguments,2))}catch(e){return t(e)}},catch:t,composedTry:function(e,r){return function(){try{return e.apply(r,[].slice.call(arguments))}catch(e){return t(e)}}},addUserData:function(t,r){return"string"==typeof r||"number"==typeof r||"boolean"==typeof r||null===r?(e.userData[t]=r,!0):(c(1005,t),!1)},removeUserData:function(t){return delete e.userData[t],!0}}}(k);var H=function(){let e=t+"apiv1/app/status?token="+k.token,r=t+"api/c/pull",o=t+"api/c/push",a={"content-type":"application/json"};R.request({url:e,method:"GET",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){if(200!==e.statusCode)return!1;let t=parseInt(e.data),i={u:b.getClientID(),ua:"FrontJSWechatSDK",pt:"web",uav:n,ms:t};R.request({url:r,method:"POST",header:a,data:JSON.stringify(i),success:function(e){if(200!==e.statusCode)return!1;let t=e.data;if(!t.data||!t.data.c)return!1;R.setClipboardData({data:t.data.c,complete(e){R.hideToast();let r=2;e.errMsg&&e.errMsg.search(/ok/)&&(r=1);let n={id:t["request-id"],r:r};R.request({url:o,method:"POST",header:a,data:JSON.stringify(n)})}})}})}})};const q={C:{SCRIPT:a,RESOURCE:2,XHR:4,PERFOMACE:8},V:n,try:F.try,catch:F.catch,composedTry:F.composedTry,addUserData:F.addUserData,removeUserData:F.removeUserData};return q};export default tracker;
//# sourceMappingURL=tracker_es.min.js.map